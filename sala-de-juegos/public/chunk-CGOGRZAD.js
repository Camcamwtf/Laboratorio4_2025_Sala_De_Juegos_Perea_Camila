import{a as F}from"./chunk-NTEOFLDB.js";import{a as O}from"./chunk-6PXDWWVM.js";import{a as S}from"./chunk-3K5F4FNC.js";import{k as I,l as _}from"./chunk-EONISGLO.js";import"./chunk-5YNXMIIZ.js";import"./chunk-E4ERW3Q5.js";import{a as W,b as T}from"./chunk-G24662RJ.js";import{$a as y,Cb as M,Eb as b,Hc as R,Jb as E,Kb as P,Lb as A,Pa as c,Sb as o,Ub as p,_ as f,cc as C,da as u,ea as v,na as d,sb as w,tb as n,ub as r,vb as k}from"./chunk-TXKU6S6B.js";import{g as N,j as m}from"./chunk-4ZZIO3ZI.js";var g=N(O());var j=["game"],D=class x{canvasRef;ctx;results=f(F);auth=f(S);partidaIniciada=d(!1);puntaje=d(0);nivel=d(1);vidas=d(3);pausado=d(!1);corriendo=!1;tiempoInicial=0;tiempoFinal=0;rafId=0;W=640;H=480;paddle={w:100,h:12,x:270,y:440,speed:6,moveLeft:!1,moveRight:!1};ball={r:6,x:320,y:320,vx:4,vy:-4,speedMax:8};cols=10;rows=6;brickW=58;brickH=18;brickGap=4;bricks=[];dragging=!1;color={bg1:"#0c1224",grid:"rgba(120,160,255,.08)",paddle:"#6EA8FE",ball:"#8A8DFF",brick1:"#2AAFA2",brick2:"#6EA8FE",brick3:"#8A8DFF",text:"#EAF2FF"};gano=C(()=>this.bricks.every(t=>t.hp<=0));ngAfterViewInit(){let t=this.canvasRef.nativeElement;this.modificarTama\u00F1oCanvas();let i=t.getContext("2d");if(!i)throw new Error("Canvas 2D context not available");this.ctx=i,this.iniciarNivel(),this.bindEvents(),this.empezarJuego()}ngOnDestroy(){cancelAnimationFrame(this.rafId),this.unbindEvents()}empezarJuego(){this.corriendo=!0,this.tiempoInicial=performance.now(),this.tiempoFinal=this.tiempoInicial;let t=i=>{if(this.rafId=requestAnimationFrame(t),this.pausado())return;let e=Math.min(32,i-this.tiempoFinal);this.tiempoFinal=i,this.actualizarJuego(e/16.67),this.dibujarPantalla()};this.rafId=requestAnimationFrame(t)}pauseToggle(){this.pausado.update(t=>!t)}reiniciarJuego(){this.puntaje.set(0),this.nivel.set(1),this.vidas.set(3),this.reiniciarPosicionPelota(!0),this.iniciarNivel(),this.pausado.set(!1),this.partidaIniciada.set(!1),this.tiempoInicial=performance.now()}iniciarNivel(){this.bricks=[];let t=(this.W-(this.cols*this.brickW+(this.cols-1)*this.brickGap))/2,i=70;for(let e=0;e<this.rows;e++)for(let a=0;a<this.cols;a++){let s=t+a*(this.brickW+this.brickGap),l=i+e*(this.brickH+this.brickGap),h=1+Math.floor(e/2);this.bricks.push({x:s,y:l,hp:h})}}cargarSiguienteNivel(){this.nivel.update(t=>t+1),this.ball.vx*=1.1,this.ball.vy*=1.1,this.paddle.speed*=1.05,this.rows=Math.min(8,this.rows+1),this.iniciarNivel(),this.reiniciarPosicionPelota(!1)}reiniciarPosicionPelota(t=!1){this.paddle.w=Math.max(70,100-(this.nivel()-1)*4),this.paddle.x=(this.W-this.paddle.w)/2,this.paddle.y=this.H-40,t?(this.ball.x=this.W/2,this.ball.y=this.H/2):(this.ball.x=this.W/2,this.ball.y=this.H-60);let i=Math.min(this.ball.speedMax,4+(this.nivel()-1)*.8),e=-Math.PI/3+Math.random()*Math.PI/6;this.ball.vx=i*Math.cos(e),this.ball.vy=i*Math.sin(e)}actualizarJuego(t){if(this.paddle.moveLeft&&(this.paddle.x-=this.paddle.speed*t),this.paddle.moveRight&&(this.paddle.x+=this.paddle.speed*t),this.paddle.x=Math.max(0,Math.min(this.W-this.paddle.w,this.paddle.x)),this.ball.x+=this.ball.vx*t,this.ball.y+=this.ball.vy*t,this.ball.x<this.ball.r&&(this.ball.x=this.ball.r,this.ball.vx*=-1),this.ball.x>this.W-this.ball.r&&(this.ball.x=this.W-this.ball.r,this.ball.vx*=-1),this.ball.y<this.ball.r&&(this.ball.y=this.ball.r,this.ball.vy*=-1),this.ball.y+this.ball.r>=this.paddle.y&&this.ball.y-this.ball.r<=this.paddle.y+this.paddle.h&&this.ball.x>=this.paddle.x&&this.ball.x<=this.paddle.x+this.paddle.w){this.ball.y=this.paddle.y-this.ball.r,this.ball.vy*=-1;let i=(this.ball.x-(this.paddle.x+this.paddle.w/2))/(this.paddle.w/2);this.ball.vx+=i*1.8;let e=Math.hypot(this.ball.vx,this.ball.vy),a=this.ball.speedMax+this.nivel()*.6;e>a&&(this.ball.vx*=a/e,this.ball.vy*=a/e)}if(this.ball.y-this.ball.r>this.H){if(this.vidas.update(i=>i-1),this.vidas()<=0){this.finalizarJuego();return}this.reiniciarPosicionPelota(!1)}for(let i of this.bricks){if(i.hp<=0)continue;let e=i.x,a=i.y,s=this.brickW,l=this.brickH;if(this.ball.x+this.ball.r>e&&this.ball.x-this.ball.r<e+s&&this.ball.y+this.ball.r>a&&this.ball.y-this.ball.r<a+l){let h=Math.min(this.ball.x+this.ball.r-e,e+s-(this.ball.x-this.ball.r)),H=Math.min(this.ball.y+this.ball.r-a,a+l-(this.ball.y-this.ball.r));h<H?this.ball.vx*=-1:this.ball.vy*=-1,i.hp-=1,this.puntaje.update(L=>L+10);break}}this.gano()&&(this.puntaje.update(i=>i+100),this.cargarSiguienteNivel())}dibujarPantalla(){let t=this.ctx;t.clearRect(0,0,this.W,this.H),t.fillStyle=this.color.bg1,t.fillRect(0,0,this.W,this.H),t.strokeStyle=this.color.grid,t.lineWidth=1;for(let i=0;i<this.W;i+=32)t.beginPath(),t.moveTo(i,0),t.lineTo(i,this.H),t.stroke();for(let i=0;i<this.H;i+=32)t.beginPath(),t.moveTo(0,i),t.lineTo(this.W,i),t.stroke();t.fillStyle=this.color.paddle,t.fillRect(this.paddle.x,this.paddle.y,this.paddle.w,this.paddle.h),t.fillStyle=this.color.ball,t.beginPath(),t.arc(this.ball.x,this.ball.y,this.ball.r,0,Math.PI*2),t.fill();for(let i of this.bricks)i.hp<=0||(t.fillStyle=i.hp===1?this.color.brick1:i.hp===2?this.color.brick2:this.color.brick3,t.fillRect(i.x,i.y,this.brickW,this.brickH));t.fillStyle=this.color.text,t.font="bold 14px monospace",t.fillText(`Puntaje ${this.puntaje()}`,10,18),t.fillText(`Nivel ${this.nivel()}`,100,18),t.fillText(`Vidas ${this.vidas()}`,190,18),this.pausado()&&(t.fillStyle="rgba(0,0,0,.45)",t.fillRect(0,0,this.W,this.H),t.fillStyle="#EAF2FF",t.font="bold 28px monospace",t.fillText("PAUSA",this.W/2-52,this.H/2))}keyDown=t=>{t.key==="ArrowLeft"&&(this.paddle.moveLeft=!0),t.key==="ArrowRight"&&(this.paddle.moveRight=!0),t.key.toLowerCase()==="p"&&this.pauseToggle()};keyUp=t=>{t.key==="ArrowLeft"&&(this.paddle.moveLeft=!1),t.key==="ArrowRight"&&(this.paddle.moveRight=!1)};touchStart=t=>{this.dragging=!0,this.touchMove(t)};touchMove=t=>{if(!this.dragging)return;let i=this.canvasRef.nativeElement.getBoundingClientRect(),e=t.touches[0].clientX-i.left,a=this.W/i.width,s=e*a;this.paddle.x=Math.max(0,Math.min(this.W-this.paddle.w,s-this.paddle.w/2))};touchEnd=()=>{this.dragging=!1};resize=()=>this.modificarTama\u00F1oCanvas();bindEvents(){window.addEventListener("keydown",this.keyDown),window.addEventListener("keyup",this.keyUp);let t=this.canvasRef.nativeElement;t.addEventListener("touchstart",this.touchStart,{passive:!0}),t.addEventListener("touchmove",this.touchMove,{passive:!0}),t.addEventListener("touchend",this.touchEnd),window.addEventListener("resize",this.resize)}unbindEvents(){window.removeEventListener("keydown",this.keyDown),window.removeEventListener("keyup",this.keyUp);let t=this.canvasRef.nativeElement;t.removeEventListener("touchstart",this.touchStart),t.removeEventListener("touchmove",this.touchMove),t.removeEventListener("touchend",this.touchEnd),window.removeEventListener("resize",this.resize)}modificarTama\u00F1oCanvas(){let t=this.canvasRef?.nativeElement;if(!t)return;let i=t.parentElement,e=Math.min(i.clientWidth-4,960),a=Math.max(320,Math.floor(e)),s=Math.floor(a*3/4);this.W=a,this.H=s;let l=Math.min(2,window.devicePixelRatio||1);t.width=Math.floor(this.W*l),t.height=Math.floor(this.H*l),t.style.width=`${this.W}px`,t.style.height=`${this.H}px`;let h=t.getContext("2d");h&&h.setTransform(l,0,0,l,0,0),this.paddle.y=this.H-40}finalizarJuego(){return m(this,null,function*(){this.pausado.set(!0),this.corriendo=!1,cancelAnimationFrame(this.rafId),yield this.guardarJuego(!0)})}guardarJuego(t=!1){return m(this,null,function*(){if(!this.partidaIniciada())return;let i=yield this.auth.getUsuarioActual();if(!i)return;let e=Math.round(performance.now()-this.tiempoInicial);try{yield this.results.guardarResultado({ID_USUARIO:i.id,JUEGO:"Arkanoid",PUNTAJE:this.puntaje(),TIEMPO_PARTIDA:e,GANO:!t}),g.default.fire({icon:"success",title:"\xA1Listo!",text:"Sus resultados han sido guardados con \xE9xito.",customClass:{popup:"swal-cold-popup",title:"swal-cold-title",confirmButton:"swal-cold-btn"},buttonsStyling:!1})}catch{g.default.fire({icon:"error",title:"Error al guardar los resultados",text:"Por favor, intente nuevamente.",customClass:{popup:"swal-cold-popup",title:"swal-cold-title",confirmButton:"swal-cold-btn"},buttonsStyling:!1})}})}static \u0275fac=function(i){return new(i||x)};static \u0275cmp=y({type:x,selectors:[["arkanoid"]],viewQuery:function(i,e){if(i&1&&E(j,7),i&2){let a;P(a=A())&&(e.canvasRef=a.first)}},decls:23,vars:5,consts:[["game",""],[1,"wrap"],["appearance","outlined"],[1,"hud"],[1,"controls",2,"margin-left","auto"],["mat-flat-button","","color","primary",3,"click"],["mat-flat-button","",1,"reiniciar-button",3,"click"],["mat-raised-button","",1,"guardar-resultados-button",3,"click","disabled"],[1,"canvas-box"],["width","640","height","480","aria-label","Breakout"]],template:function(i,e){if(i&1){let a=M();n(0,"div",1)(1,"mat-card",2)(2,"div",3)(3,"b"),o(4),r(),n(5,"b"),o(6),r(),n(7,"b"),o(8),r(),n(9,"div",4)(10,"button",5),b("click",function(){return u(a),v(e.pauseToggle())}),o(11),r(),n(12,"button",6),b("click",function(){return u(a),v(e.reiniciarJuego())}),o(13,"Reiniciar"),r(),n(14,"button",7),b("click",function(){return u(a),v(e.guardarJuego())}),o(15,"Guardar Resultado"),r()()()(),n(16,"div",8),k(17,"canvas",9,0),r(),n(19,"mat-card",2)(20,"p")(21,"small"),o(22,"Controles: \u2190 \u2192 para mover"),r()()()()}i&2&&(c(4),p("Puntaje: ",e.puntaje()),c(2),p("Nivel: ",e.nivel()),c(2),p("Vidas: ",e.vidas()),c(3),p(" ",e.pausado()?"Reanudar (P)":"Pausar (P)"," "),c(3),w("disabled",!e.partidaIniciada()))},dependencies:[R,T,W,_,I],styles:[".wrap[_ngcontent-%COMP%]{display:grid;padding:16px;gap:16px}.hud[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;align-items:center}.hud[_ngcontent-%COMP%]   b[_ngcontent-%COMP%]{display:inline-block;min-width:84px}.canvas-box[_ngcontent-%COMP%]{display:grid;place-items:center}canvas[_ngcontent-%COMP%]{background:#0a101cd9;border:1px solid rgba(130,160,255,.25);image-rendering:pixelated;border-radius:8px;box-shadow:0 10px 30px #00000059;max-width:100%;height:auto}.controls[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.reiniciar-button[_ngcontent-%COMP%], .guardar-button[_ngcontent-%COMP%]{color:var(--color-white);background-color:var(--color-pink)}"]})};export{D as Arkanoid};
