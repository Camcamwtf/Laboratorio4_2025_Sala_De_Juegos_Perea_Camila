import{a as S,b as n}from"./chunk-5YNXMIIZ.js";import{P as I,V as O,n as u}from"./chunk-TXKU6S6B.js";import{j as s}from"./chunk-4ZZIO3ZI.js";var l=class a{supabase;constructor(){this.supabase=S(n.supabase.url,n.supabase.anonKey)}pickEmail(e){return e?Array.isArray(e)?e[0]?.EMAIL??"\u2014":e.EMAIL??"\u2014":"\u2014"}getRespuestas$(){return u(this.supabase.from("ENCUESTAS").select("ID_ENCUESTA, JUEGO, PUNTAJE, COMENTARIO, FECHA, ID_USUARIO").order("FECHA",{ascending:!1})).pipe(I(o=>s(this,[o],function*({data:e,error:t}){if(t)return console.error("[ENCUESTAS] error select ENCUESTAS:",t),[];let i=e??[],E=Array.from(new Set(i.map(r=>r.ID_USUARIO).filter(Boolean))),U=new Map;if(E.length>0){let{data:r,error:A}=yield this.supabase.from("USUARIOS").select("ID_USUARIO, EMAIL").in("ID_USUARIO",E);A?console.warn("[ENCUESTAS] no pude resolver emails:",A.message):(r??[]).forEach(c=>U.set(c.ID_USUARIO,c.EMAIL))}return i.map(r=>({id:r.ID_ENCUESTA,usuarioEmail:U.get(r.ID_USUARIO)??"\u2014",juego:r.JUEGO,puntaje:r.PUNTAJE,fechaISO:r.FECHA,comentario:r.COMENTARIO??null}))})))}crearEncuesta(e){return s(this,null,function*(){let{error:t}=yield this.supabase.from("ENCUESTAS").insert({ID_USUARIO:e.ID_USUARIO,JUEGO:e.JUEGO,PUNTAJE:e.PUNTAJE,COMENTARIO:e.COMENTARIO??null,FECHA:new Date().toISOString()});if(t)throw t})}listarPorUsuario(e){return s(this,null,function*(){let{data:t,error:o}=yield this.supabase.from("ENCUESTAS").select("ID_ENCUESTA, JUEGO, PUNTAJE, COMENTARIO, FECHA").eq("ID_USUARIO",e).order("FECHA",{ascending:!1});if(o)throw o;return t??[]})}static \u0275fac=function(t){return new(t||a)};static \u0275prov=O({token:a,factory:a.\u0275fac,providedIn:"root"})};export{l as a};
